from CalTools.GetValues import get_line_value_via_lists
import numpy as np
import pandas as pd

transmission = '''
0.28843	0.8351
0.3505	0.8492
0.45272	0.8492
0.50384	0.85264
0.60606	0.85264
0.70829	0.85264
0.88171	0.85108
0.96386	0.84763
1.17744	0.84763
1.27966	0.85264
1.32165	0.84763
1.41292	0.84763
1.48412	0.8351
1.52428	0.82633
1.5973	0.82821
1.64841	0.84231
1.70865	0.83698
1.75064	0.83886
1.80175	0.84387
1.86199	0.8351
1.90398	0.84231
1.9843	0.8492
2.02628	0.8492
2.0774	0.8564
2.16867	0.85985
2.23986	0.85985
2.2709	0.86329
2.34209	0.85797
2.38408	0.85797
2.40416	0.86862
2.49543	0.88084
2.57752	0.86674
2.57758	0.85264
2.63964	0.84231
2.65972	0.80377
2.68893	0.78435
2.71084	0.76524
2.73092	0.74237
2.77108	0.71073
2.80211	0.68285
2.81306	0.67408
2.84227	0.65121
2.85322	0.64432
2.88426	0.59671
2.91529	0.58292
2.93537	0.57227
2.9445	0.54063
2.97553	0.5093
2.99561	0.48832
3.02664	0.45668
3.0376	0.43913
3.05768	0.3934
3.06863	0.37961
3.09784	0.34265
3.11974	0.2919
3.14895	0.28125
3.17086	0.25149
3.17998	0.24115
3.19094	0.19729
3.22197	0.1832
3.2311	0.16377
3.26213	0.15688
3.28211	0.12524
3.28221	0.11146
3.31324	0.09016
3.33332	0.07794
3.36436	0.06416
3.39539	0.04473
3.46658	0.03064
3.60897	0.01842
3.7112	0.01309
4.02883	0.00965
4.13106	0.0062
5.07118	0.0062
5.22269	0.0
9.94337	0.0
'''
reflectance = '''
0.29938	0.15156
0.3505	0.14466
0.46185	0.14654
0.52392	0.14466
0.544	0.14122
0.62614	0.14654
0.67726	0.14279
0.77948	0.14811
0.89084	0.14811
0.94195	0.14811
1.04418	0.14122
1.1464	0.14811
1.25958	0.14466
1.32165	0.14466
1.41292	0.14811
1.5042	0.1691
1.60642	0.16565
1.7196	0.16221
1.7908	0.14999
1.87294	0.15688
1.9843	0.14654
2.1066	0.13777
2.18875	0.13057
2.28185	0.13057
2.33296	0.12524
2.43519	0.12023
2.51551	0.12712
2.59766	0.13589
2.62869	0.15532
2.6798	0.17255
2.71996	0.19197
2.751	0.21484
2.78203	0.24804
2.81306	0.28657
2.84227	0.30412
2.8733	0.31821
2.89338	0.36019
2.91529	0.37961
2.92442	0.39183
2.95545	0.43224
2.98645	0.44603
2.98648	0.48299
3.01752	0.49176
3.02664	0.53907
3.05768	0.58825
3.10879	0.63023
3.14895	0.69507
3.17086	0.7336
3.17998	0.78623
3.21102	0.79657
3.24205	0.82476
3.25118	0.83698
3.27308	0.87739
3.31324	0.91248
3.3534	0.93347
3.39539	0.96135
3.43555	0.97356
3.53778	0.972
3.62905	0.97544
3.7112	0.97544
3.82438	0.96479
3.93573	0.97012
4.05804	0.95445
4.16026	0.95445
4.26249	0.95257
4.32456	0.94913
4.46694	0.9438
4.52901	0.93159
4.53996	0.93002
4.64036	0.93347
4.73346	0.92814
4.81561	0.93002
4.94704	0.93002
4.97808	0.92281
5.04014	0.91404
5.18253	0.91404
5.2738	0.89995
5.32492	0.88428
5.42714	0.87207
5.54032	0.85108
5.5604	0.83886
5.62247	0.81944
5.6316	0.81411
5.70462	0.80033
5.74478	0.78435
5.78494	0.77213
5.85613	0.75647
5.88716	0.73016
5.9182	0.71073
5.95836	0.69507
5.98939	0.68097
6.05146	0.66155
6.10257	0.64777
6.1336	0.62678
6.18472	0.61613
6.21392	0.58292
6.25591	0.56005
6.28694	0.53562
6.34718	0.51808
6.44028	0.49521
6.48044	0.46889
6.53156	0.43725
6.5918	0.4006
6.64291	0.37429
6.73601	0.35487
6.82728	0.33732
6.88935	0.31289
6.94959	0.29535
6.99158	0.27248
7.06277	0.27624
7.13396	0.27968
7.24714	0.26746
7.34937	0.27248
7.38953	0.2919
7.44064	0.31821
7.4808	0.35142
7.53192	0.38838
7.56295	0.42159
7.60494	0.44101
7.61406	0.47234
7.67613	0.5093
7.70531	0.54439
7.70534	0.56193
7.73637	0.60203
7.78748	0.6722
7.82947	0.74582
7.82947	0.79312
7.88971	0.82633
7.94082	0.80722
7.95178	0.79156
7.97186	0.74927
8.03392	0.68442
8.07408	0.64432
8.11424	0.62302
8.15623	0.60548
8.22742	0.58981
8.30957	0.58292
8.40084	0.58825
8.51402	0.58292
8.59434	0.59671
8.67649	0.6249
8.73856	0.65811
8.76959	0.67753
8.82983	0.70384
8.90102	0.68285
8.94301	0.65811
8.97222	0.61957
9.00325	0.58637
9.04524	0.50743
9.10548	0.47422
9.16754	0.45668
9.36104	0.43913
9.41216	0.41971
9.46327	0.40593
9.51438	0.38306
9.55637	0.35487
9.59653	0.32855
9.66772	0.30412
9.70789	0.27968
9.79003	0.23927
9.86122	0.22173
9.96345	0.20951
'''
emissivity = '''
0.33042	0.0203
0.55495	0.00965
0.76853	0.01309
0.94195	0.01309
1.16831	0.01309
1.3107	0.00965
1.48412	0.01309
1.67762	0.00276
1.80175	0.01309
1.97517	0.01654
2.15772	0.01842
2.37312	0.02531
2.54654	0.01309
2.64877	0.02719
2.73092	0.05538
2.8733	0.05163
2.9445	0.03941
3.07776	0.04129
3.22197	0.02187
3.39539	0.00432
3.57794	0.02187
3.77326	0.02531
3.95581	0.02719
4.13106	0.04473
4.27344	0.05883
4.48885	0.06416
4.63124	0.07293
4.83569	0.07637
5.00911	0.08514
5.1515	0.09204
5.2446	0.10269
5.39794	0.129
5.54032	0.15156
5.62247	0.1832
5.7247	0.21296
5.81597	0.24272
5.88716	0.2778
5.94923	0.306
6.0405	0.3392
6.1117	0.36896
6.19384	0.40217
6.24496	0.43381
6.27599	0.46889
6.36726	0.49865
6.46036	0.52841
6.50052	0.56193
6.55164	0.59514
6.62283	0.62835
6.75609	0.65466
6.8784	0.68442
6.94959	0.71794
7.0719	0.73016
7.23619	0.73517
7.36945	0.72483
7.42969	0.69319
7.47168	0.65811
7.51184	0.62835
7.54287	0.58825
7.62502	0.55817
7.67613	0.52152
7.68526	0.48832
7.71629	0.41814
7.7674	0.37961
7.79844	0.30944
7.81852	0.27248
7.82947	0.22517
7.86963	0.19197
7.9317	0.18664
7.97186	0.22173
7.98281	0.25681
8.00289	0.29378
8.054	0.32698
8.07408	0.36552
8.14528	0.39716
8.21647	0.41627
8.4118	0.41627
8.57426	0.41282
8.65641	0.38306
8.74768	0.35142
8.7988	0.31821
8.88094	0.31289
8.94301	0.34797
8.95214	0.38651
9.00325	0.41971
9.00325	0.45135
9.04524	0.48644
9.07444	0.52309
9.21866	0.55128
9.36104	0.56883
9.47422	0.60203
9.54542	0.63555
9.58558	0.66343
9.64764	0.69852
9.70789	0.73016
9.759	0.75992
9.91234	0.79156
'''

transmission1 = '''
0.3989	0.5367
0.38976	0.56136
0.40987	0.58571
0.429971	0.61005
0.429972	0.64501
0.429973	0.68683
0.429974	0.74957
0.44094	0.76205
0.46104	0.78796
0.47018	0.81418
0.48115	0.83166
0.49211	0.84227
0.55242	0.84914
0.6237	0.8404
0.65477	0.83353
0.68584	0.83509
0.73702	0.84383
0.80829	0.84383
0.87957	0.84383
0.93074	0.83509
0.97095	0.83696
1.03309	0.83166
1.06416	0.82822
1.10437	0.83353
1.12447	0.84383
1.18661	0.8404
1.32917	0.8404
1.40045	0.8301
1.47172	0.82479
1.51376	0.83353
1.59418	0.82822
1.64535	0.83353
1.71845	0.82635
1.80984	0.82635
1.87015	0.82136
1.91218	0.83166
1.94325	0.8404
2.01453	0.85444
2.07484	0.84383
2.12602	0.83166
2.18816	0.82136
2.24847	0.80731
2.29964	0.78796
2.32157	0.77235
2.36178	0.75675
2.39285	0.74083
2.42209	0.71648
2.44403	0.69557
2.50434	0.67466
2.53541	0.64501
2.56648	0.61348
2.58658	0.58914
2.62679	0.55605
2.65786	0.5314
2.7401	0.43558
2.77117	0.40405
2.79128	0.39375
2.81138	0.36566
2.86255	0.34818
2.90276	0.33788
2.97404	0.33944
3.01607	0.35193
3.06725	0.35536
3.10746	0.3641
3.14766	0.37783
3.19884	0.39188
3.25001	0.39719
3.31215	0.40936
3.36332	0.39719
3.39439	0.3744
3.4145	0.35193
3.45471	0.32384
3.48578	0.30823
3.51685	0.28014
3.54792	0.25767
3.57716	0.23644
3.61919	0.21928
3.64844	0.19805
3.67037	0.18963
3.69047	0.17027
3.74165	0.15623
3.80196	0.16154
3.87323	0.17027
3.95548	0.17215
4.00665	0.16154
4.04869	0.12845
4.0889	0.11628
4.109	0.09162
4.19124	0.06571
4.23145	0.0498
4.25155	0.03419
4.29359	0.01858
4.3539	0.00984
4.40508	0.00267
4.48732	0.00267
4.53849	0.00984
4.60977	0.00267
5.21289	0.00454
5.29513	7.67E-04
9.92453	0.0042
'''
reflectance1 = '''
0.3989	0.45462
0.41901	0.39188
0.42997	0.37284
0.42997	0.26641
0.42997	0.24175
0.44094	0.22614
0.45008	0.20867
0.45008	0.18588
0.47018	0.16341
0.50125	0.15092
0.54329	0.1425
0.58349	0.15092
0.64381	0.16154
0.70595	0.15467
0.75712	0.14749
0.80829	0.15092
0.8485	0.1581
0.86861	0.15092
0.91064	0.14936
0.95085	0.15467
0.99288	0.15623
1.06416	0.16154
1.08427	0.15467
1.12447	0.14749
1.19575	0.15092
1.28896	0.14936
1.39131	0.15623
1.47172	0.16341
1.54483	0.15623
1.61611	0.15966
1.70749	0.16684
1.79887	0.16684
1.87015	0.16684
1.91218	0.15966
1.94325	0.14936
2.00357	0.14062
2.07484	0.1425
2.15709	0.15966
2.21923	0.17714
2.2704	0.19119
2.29964	0.20679
2.37092	0.21928
2.39285	0.23644
2.40199	0.2611
2.44403	0.29075
2.48423	0.30979
2.52444	0.34475
2.56648	0.37783
2.59572	0.40062
2.62679	0.43027
2.67796	0.45462
2.72	0.49145
2.74924	0.52796
2.80041	0.57853
2.85159	0.61348
2.92287	0.63814
3.03618	0.62066
3.12756	0.59445
3.1696	0.57509
3.25001	0.56292
3.31215	0.56136
3.37246	0.57697
3.4145	0.59788
3.46567	0.61192
3.52598	0.62566
3.61919	0.61192
3.67037	0.58727
3.74165	0.56136
3.78185	0.53327
3.85313	0.50175
3.89517	0.47584
3.95548	0.45118
4.02676	0.42684
4.09803	0.39188
4.14921	0.37971
4.23145	0.36223
4.29359	0.35536
4.36487	0.35536
4.43615	0.35193
4.45625	0.35193
4.62074	0.32571
4.70115	0.31853
4.71212	0.30105
4.76329	0.28545
4.81447	0.26453
4.90585	0.24019
4.99906	0.21397
5.1014	0.18775
5.2531	0.16497
5.37555	0.1528
5.57111	0.14936
5.76484	0.1425
5.88729	0.12845
6.0207	0.11441
6.20347	0.10036
6.36795	0.09349
6.55255	0.09006
6.6951	0.10036
6.88883	0.12127
7.03139	0.1425
7.1447	0.16684
7.22694	0.19649
7.31832	0.22427
7.34939	0.24019
7.40057	0.26266
7.42981	0.28357
7.46088	0.31354
7.51205	0.34662
7.54312	0.3744
7.58333	0.40936
7.6144	0.45649
7.68568	0.52453
7.70578	0.57353
7.74782	0.62753
7.75696	0.65188
7.78803	0.70618
7.80813	0.75675
7.8593	0.80918
7.93058	0.79857
7.95251	0.77079
7.98176	0.7374
8.01282	0.71648
8.03293	0.65905
8.04389	0.63096
8.05486	0.58571
8.0841	0.56136
8.10603	0.5264
8.18645	0.4774
8.22849	0.45306
8.26869	0.42684
8.33083	0.40936
8.44232	0.40062
8.5337	0.40593
8.58487	0.42153
8.66712	0.45118
8.72926	0.4774
8.78043	0.51049
8.8316	0.51922
8.91202	0.51049
8.95406	0.47584
8.97416	0.44588
9.01437	0.4337
9.02533	0.41279
9.06554	0.39375
9.23003	0.4234
9.35248	0.42153
9.42376	0.42496
9.506	0.41622
9.58642	0.40062
9.63759	0.38501
9.73994	0.35536
9.83315	0.32384
9.90443	0.29606
9.9757	0.28201
'''
emissivity1 = '''
0.44094	0.00984
0.66574	0.00797
0.85947	0.00267
1.06416	0.00984
1.25789	0.00797
1.36938	0.01328
1.57407	0.00984
1.75866	0.00797
1.88111	0.01328
2.05474	0.01328
2.24847	0.01328
2.40199	0.01671
2.55551	0.00984
2.68893	0.03419
2.86255	0.03232
3.04714	0.03076
3.1897	0.03762
3.36332	0.04106
3.47481	0.06727
3.52598	0.10411
3.57716	0.13719
3.59726	0.17215
3.64844	0.20867
3.69047	0.24518
3.74165	0.28014
3.80196	0.3151
3.89517	0.34475
3.95548	0.37783
3.99751	0.41123
4.03772	0.44775
4.07793	0.48614
4.109	0.51922
4.16017	0.55262
4.18028	0.56479
4.23145	0.60131
4.29359	0.6344
4.47635	0.64688
4.48732	0.64314
4.60063	0.67123
4.71212	0.70088
4.79436	0.73053
4.89671	0.76361
5.01916	0.78983
5.12151	0.81792
5.26406	0.84227
5.4779	0.85257
5.68259	0.85787
5.83611	0.87192
6.0207	0.8894
6.20347	0.905
6.39902	0.91374
6.60372	0.905
6.76638	0.89096
6.92904	0.87005
7.07342	0.84914
7.17577	0.81792
7.26715	0.7864
7.35853	0.75675
7.40057	0.72179
7.44078	0.68683
7.49195	0.65031
7.62537	0.54201
7.6345	0.50892
7.67654	0.46866
7.74782	0.3641
7.78803	0.29075
7.79899	0.26797
7.8191	0.22958
7.85017	0.19306
7.90134	0.17027
7.94155	0.20867
7.96165	0.24518
7.99272	0.28357
8.00369	0.31853
8.02379	0.35536
8.04389	0.39188
8.12614	0.50019
8.19742	0.5314
8.25773	0.56979
8.33997	0.59601
8.52456	0.59257
8.63605	0.56136
8.72926	0.52796
8.7585	0.49301
8.90288	0.48957
8.94309	0.52297
8.96319	0.55949
9.02533	0.59445
9.10758	0.59601
9.27024	0.57509
9.40365	0.57353
9.55718	0.59601
9.66866	0.6241
9.7509	0.65375
9.84229	0.68683
9.92453	0.71648
'''

filter_path = 'F:\\研究生\\计算及工作整理\\模型验证\\截止膜验证.xlsx'


def get_wave_attr(st):
    str_list = [i.split('\t') for i in st.split('\n') if i]
    float_list = [[float(i[0]), float(i[1])] for i in str_list]
    return np.array(float_list)


def verify_attr_of_filter():
    trs, rfs, ems = get_wave_attr(transmission), get_wave_attr(
        reflectance), get_wave_attr(emissivity)
    pos_tr, pos_rf, pos_em = 0, 0, 0
    for wave in np.arange(0.3, 10.3, 0.1):
        tr, pos_tr = get_line_value_via_lists(wave, trs[:, 0], trs[:, 1],
                                              pos=pos_tr, get_pos=True)
        ref, pos_rf = get_line_value_via_lists(wave, rfs[:, 0], rfs[:, 1],
                                               pos=pos_rf, get_pos=True)
        em, pos_em = get_line_value_via_lists(wave, ems[:, 0], ems[:, 1],
                                              pos=pos_em, get_pos=True)
        print('{:.3}'.format(wave), '\t', tr + ref + em)


def get_pars_via_str(tr_str, rf_str):
    tr_np = get_wave_attr(tr_str)
    trs = [tr_np[:, 0], tr_np[:, 1]]
    rf_np = get_wave_attr(rf_str)
    rfs = [rf_np[:, 0], rf_np[:, 1]]
    return {'trs': trs, 'rfs': rfs, 'scatter': True}


def pars_spectrum_via_excel(path, filter_type='Sheet1'):
    data = pd.read_excel(path, sheet_name=filter_type, usecols=list(range(6)))
    trs = [
        [w for w in data['wave'] if not np.isnan(w)],
        [t for t in data['tran'] if not np.isnan(t)]
    ]
    wave_ref = 'wave.1' if 'wave.1' in data.keys() else 'wave'
    rfs = [
        [w for w in data[wave_ref] if not np.isnan(w)],
        [r for r in data['ref'] if not np.isnan(r)]
    ]
    return {'trs': trs, 'rfs': rfs, 'scatter': True}


if __name__ == '__main__':
    # print(get_pars_via_str(transmission, reflectance))
    # verify_attr_of_filter()
    # pars_spectrum_via_excel(filter_path, 'TCO-solar')
    print(pars_spectrum_via_excel('F:\\研究生\\计算及工作整理\\截止膜\\计算\\AZO-Ag.xlsx'))
    pass
